# Malware

Deriva da malicius software, è un software programmato per fare del male. Modo che sfrutta l'insicurezza dei sistemi, sviluppatosi in parallelo agli exploit. 

Lo scopo è fare in modo che qualcuno inavvertitamente esegua il codice malevolo. 

## Storia del malware

Il primo virus sperimentale 1982, primo exploit 1988. Fino agli anni 2000 i virus si sviluppano soprattutto su windows, mentre exploit su unix. 

Nel mondo Windows fino alla fine degli anni '90 chi usava il sistema era amministratore di sistema. È più complicato far girare virus su unix, per la base di utenza diversa sotto il punto di vista numerico e di conoscenza informatica. 

### BRAIN VIRUS 1986

Realizzato da due pakistani. È un boot sector virus. Quando la ROM fa partire il bootstrap del sistema facendo partire il programma nel boot sector. 

Gli autori avevano fatto un programma che vendevano ma che era stato piratato quindi partiva per dire alla gente di pagarli. 

### CIH Chernobyl virus

Fatto per riscrivere la eprom. Dopo che aggiornava il bios, il sistema non partiva più. Questo è il primo virus che fa male anche all'hardware.

## Esecuzione

È l'utente che manda in esecuzione il virus (apparte i worms che si eseguono da soli). Sia virus che worm hanno una condizione di triggering. In questo modo è più complicato da identificare.

> Virus Michelangelo
>
> Questo virus si eseguiva solo nel giorno di nascita di Michelangelo

### Virus

I virus sono la prima tipologia di malware inventata. Per potersi propagare hanno bisogno di attacarsi a qualcosa, in genere un eseguibile. Simile al virus biologico. 

Prima di tutto i virus controllano che un file non sia già infettato. 

### Worm

Il worm è un modo per automatizzare l'utilizzo di un exploit e prova a propagarsi. 

## Dove

Negli attachment di posta elettronica (email-based). Spesso si trovano anche in file e documenti. In un file della swit di office è molto probabile trovarci un worm, nei file txt no. Questi si chiamano **macro virus** che sfruttano delle vulnerabilità presenti negli interpreti. 

Quindi il modo migliore per infettare dei dispositivi è infettare degli eseguibili. 

Il sistema operativo carica il programma, parte mettendo nel program counter l'entrypoint del programma. Il virus nell'entrypoint di un programma si mette sopra l'entrypoin. Il programmasi può anche mettere in coda al codice eseguibile fa in modo che dopo che viene eseguito il virus si esegui il programma. 

## Programmi per riconoscere i virus

Sistemi che analizzano dei programmi e che decidono se un programma è un virus oppure no. Questo programma non potrà mai esistere è un problema indecidibile. 

> **Dimostrazione**
>
> P dice se un altro programma E è un virus
>
> Si da a P come input P stesso. 

Non esistono malware detector. Si creano delle tecniche per approssimare se un programma è un virus oppure no.

La prima tecnica che si usa è la prevenzione. Le varie tecniche di prevenzione sono:

1. formazione degli utenti
2. Code signing -> Meccanismo attraverso il quale il programmatore chiede a una CA una chiave per la firma di codice. Prima di rilasciare un'applicazione deve essere firmata dal programmatore. La firma viene verificata dalla CA. Sarà poi il sistema operativo a decidere se avviare il programma o no. 
   Nel corso degli anni questo sistema è stato raggirato, firmando del malware. La gente ha mandato in esecuzione un malware dato che il code signing non entra nel merito del codice eseguibile. 
3. Antivirus -> sistemi di prevention e intrusion detection. In un caso bloccano il malware prima che venga eseguito e nel secondo caso trovo il malware dopo che è stato eseguito.

## Detection

Utillizzando le **signature** si può identificare univocamente un malware. È sostanzialmetne una sequenza di bit che identifica il malware. Gli antivirus tengono un database per mettere le signature dei malware e li aggiornano costantemente. Questo blocca l'eseguibile che tiene la signature di un virus prima che parta. 

In ambiente militare si utilizza una withe list di programmi be definiti. Per sapere quali sono questi programmi calcolo l'hash di tutti i programmi di cui mi fido e lo salvo in un posto sicuro. Se l'hash è riconosciuto il programma può essere avviato. 

### Encrypted virus 

Il virus, e le repliche, non può essere riconosciuto da una stringa di bit. Ovvero ogni volta che il virus si replica viene cambiata la signature dei figli.  

Sono fatti da due pezzi:

1. Payload -> funzione con le attività brutte (cifrato)
2. funzione {E} -> {D} -> che cifra il payload

Ogni vota che si propaga cambia la chiave K di encyption il programma cambia. Per beccarlo si cerca la parte che cripta e decripta il payload. 

Il modo per non farsi scoprire sono stati inventati dei **virus polimorfi**. Questi rendono impossibile la strategia di prevention basate sulle signature. Questi virus cambiano la funzione ED. 

Una volta decriptato un virus polimorfo, il payload è sempre uguale in memoria centrare e si può fare detection.

Da qui il programma viene sandboxato o mandato in esecuzione in una macchina virtuale per leggere la signature. 

A quel punto si fanno malware che ad ogi esecuzoione si modifica. Sono i cosiddetti **virus metamorfi**. A questo punto si utilizzano delle **signature comportamentali**. 

A questo punto gli anti virus si evolvono in Endpoint Detection and Recovery (EDR). 

I malware odierni riconoscono se sono eseguiti in ambiente virtuale o reale. Se sono in esecuzione i una macchina virtuale sono assolutamente innocui. Altrimenti fanno le loro zozzerie.  

#### Reverese engeneering 

Non si può fare

## Trojan 

Il codice malevolo viene cammuffato in codice tranquillo. 

**Backdoors**: è un modo per accedere ad un dispositivo bypassando gli entry point canonici. Il malware apre una porta (TCP/IP) sul quale ci si connette .

**Rootkit**: Possono modificare funzioni di sistema operativo. Sono in user mode o in kernel mode. Se si lavora come amministratore di sistema allora si rischia di far eseguire i malware con privilegi da amministratore. Sostituiscono tutti i driver, intercettando tutto quello che viene scritto o detto all'interno di un sistema. 

> **Syscall hijacking**
>
> In sostanza vengono falsificate le syscall di sistema, facendo eseguire la sua syscall invece che quella del sistema. 

## Ransomware

Vine cifrato il contenuto del filesystem. Si chiede un pagamento in bitcoin. 

Ha una coppia di chiavi, pubblica e privata, il ransom ha la chiave pubblica e la usa per cifrare tutto compresa la chiave privata. 

Ci sono altri tipi di ransomware che non encriptano niente ma fanno minacce. 

### Wannacry

Realizzato dai nordcoreani, sfruttando una vulnerabilità di Microsoft SQL, che non era stata patchatta ed era stata rubata dalla NSA da dei craker russi. Per ogni file viene generata una chiave diversa, e viene criptata. Quando il lavoro è terminato si manda il riscatto alla vittima. 

### Botnet e Zombie

Utenti che usano usano sistemi non aggiornati. Il computer diventa a disposizione dell'autore del worm (che ha infettato ogni singolo computer della botnet). 

Queste botnet vengnono usate epr fare soprattutto delle campagne di spam. 

Le macchine prese vengono chiamate zombie e si definiscono anche **C&C**(Comman & Control). Questi sistemi sono estremamente complessi e sono molto complicati da identificare e da eradicare. 

Per identificare la botnet bisonga partire dai terminali per arrivare alla testa. Per ora si è riusciti a tirare giù una botnet gigantesaca

### Logic Bomb 

È una sequenza di istruzioni che si attiva quando si verificano delle condizioni particolari. Usate dalle software house pre farsi pagare da utenti truffaldini. 

## Classificare i Malware

Ci sono varie classificazioni, non ne esiste una universalmente accettata. 